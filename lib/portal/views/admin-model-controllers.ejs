angular.module('<%=model.module.name%>', ['<%=model.module.resource%>']).config(function($routeProvider) {
  $routeProvider
    .when('/<%=model.collection%>', {controller:<%=model.controllers.retrieve%>, templateUrl:'<%=model.views.retrieve%>'})
    .when('/<%=model.collection%>/edit/:id', {controller:<%=model.controllers.update%>, templateUrl:'<%=model.views.update%>'})
    .when('/<%=model.collection%>/new', {controller:<%=model.controllers.create%>, templateUrl:'<%=model.views.create%>'})
    .otherwise({redirectTo:'/<%=model.collection%>'});
});

<%
  var args = '';
  for(var i in model.models)
  {
    args += model.models[i].name + ',';
  }
  args = args.substring(0, args.length - 1);
%>
function <%=model.controllers.retrieve%>($scope, <%=model.name%>,<%=args%>) {
  $scope.<%=model.collection%> = <%=model.name%>.query();
  <%for (var i in model.models){
    var _model = model.models[i];
  %>
    $scope.<%=model.collection%>.<%=_model.name%> = <%=_model.name%>.query();
  <%}%>
}


function <%=model.controllers.create%>($scope, $location, <%=model.name%>) {
  $scope.save = function() {
    <%=model.name%>.save($scope.<%=model.name%>, function(<%=model.name%>) {
      //$location.path('/edit/' + project._id.$oid);
    });
  };
}


function <%=model.controllers.update%>($scope, $location, $routeParams, <%=model.name%>) {
  var self = this;
  <%=model.name%>.get({id: $routeParams.id}, function(project) {
    self.original = <%=model.name%>;
    $scope.<%=model.name%> = new <%=model.name%>(self.original);
  });

  $scope.isClean = function() {
    return angular.equals(self.original, $scope.<%=model.name%>);
  }

  $scope.destroy = function() {
    self.original.destroy(function() {
      //$location.path('/list');
    });
  };

  $scope.save = function() {
    $scope.project.update(function() {
      //$location.path('/');
    });
  };
}